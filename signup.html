<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title>TheMove - Sign Up</title>
    <!-- ‚úÖ Tailwind + Poppins -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Poppins", "sans-serif"] },
            colors: {
              primary: "#4F46E5",
              accent: "#3B82F6",
              background: "#FAFAFA",
              dark: "#1E1B4B",
            },
          },
        },
      };
    </script>
  </head>

  <body class="bg-background font-sans text-gray-800 flex flex-col min-h-screen">
    <!-- ‚úÖ Navbar -->
    <header
      class="flex justify-between items-center px-6 py-4 bg-white shadow-md"
    >
      <a href="/index.html" class="text-2xl font-bold text-primary tracking-tight hover:text-indigo-700 transition">
    TheMove
  </a>
      <nav class="flex items-center gap-4">
        <a href="/login.html" class="text-gray-600 hover:text-primary font-medium"
          >Login</a
        >
        <a
          href="/signup.html"
          class="bg-primary text-white px-4 py-2 rounded-xl hover:bg-indigo-700 transition"
          >Join</a
        >
      </nav>
    </header>

    <!-- ‚úÖ Main Content (Centered) -->
    <main
      class="flex flex-col justify-center flex-grow mx-auto w-full max-w-md px-6 py-10 gap-4"
    >
      <h2 class="text-3xl font-semibold text-center text-dark mb-6">
        Sign Up for TheMove
      </h2>

      <!-- Name -->
      <input
        id="name"
        placeholder="Name"
        class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:ring-2 focus:ring-primary outline-none"
      />

      <!-- School -->
      <select
        id="school"
        class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:ring-2 focus:ring-primary outline-none"
      >
        <option value="">Select your school</option>
        <option value="UNC - Chapel Hill">UNC - Chapel Hill</option>
      </select>

      <!-- Class -->
      <select
        id="year"
        onchange="toggleOtherClassInput()"
        class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:ring-2 focus:ring-primary outline-none"
      >
        <option value="">Select your class</option>
        <option value="Freshman">Freshman</option>
        <option value="Sophomore">Sophomore</option>
        <option value="Junior">Junior</option>
        <option value="Senior">Senior</option>
        <option value="Other">Other</option>
      </select>

      <input
        id="other-year"
        placeholder="Enter class"
        class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:ring-2 focus:ring-primary outline-none hidden"
      />

      <!-- Email -->
      <input
        id="email"
        placeholder="School Email"
        class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:ring-2 focus:ring-primary outline-none"
      />

      <!-- Password -->
      <input
        id="password"
        type="password"
        placeholder="Password"
        class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:ring-2 focus:ring-primary outline-none"
      />

      <input
        id="confirm-password"
        type="password"
        placeholder="Verify Password"
        class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:ring-2 focus:ring-primary outline-none"
      />

      <!-- Button -->
      <button
        id="sign-in-button"
        class="bg-primary text-white w-full py-2.5 rounded-xl font-medium mt-2 hover:bg-indigo-700 transition shadow-md hover:shadow-lg"
      >
        Sign Up
      </button>

      <p class="text-center text-sm text-gray-600 mt-3">
        Already have an account?
        <a href="/login.html" class="text-primary hover:underline">Login here</a>
      </p>
    </main>

    <!-- ‚úÖ Footer -->
    <footer class="mt-auto text-center py-6 text-gray-500 text-sm">
      ¬© 2025 TheMove ‚Ä¢ Made with ü©µ at UNC
    </footer>

    <!-- ‚úÖ Toast Notification -->
    <div
      id="toast"
      class="fixed top-5 left-1/2 -translate-x-1/2 bg-white shadow-lg rounded-xl px-5 py-3 text-gray-800 font-medium border border-gray-200 opacity-0 pointer-events-none transition-all duration-300 z-50"
    ></div>

    <script>
      function showToast(message, type = "info") {
        const toast = document.getElementById("toast");

        const colors = {
          info: "border-gray-300",
          success: "border-green-400 bg-green-50 text-green-700",
          error: "border-red-400 bg-red-50 text-red-700",
          warning: "border-yellow-400 bg-yellow-50 text-yellow-700",
        };

        toast.className = `fixed top-5 left-1/2 -translate-x-1/2 rounded-xl px-5 py-3 font-medium text-center shadow-lg transition-all duration-300 z-50 ${colors[type]}`;
        toast.textContent = message;
        toast.style.opacity = "1";
        toast.style.pointerEvents = "auto";

        setTimeout(() => {
          toast.style.opacity = "0";
          toast.style.pointerEvents = "none";
        }, 3000);
      }
    </script>

    <!-- ‚úÖ Firebase Logic -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        sendEmailVerification,
        setPersistence,
        browserLocalPersistence,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDuHcTFbqy9e0nov4eKHNTp89WVcQOrlTQ",
        authDomain: "themove-c75d3.firebaseapp.com",
        projectId: "themove-c75d3",
        storageBucket: "themove-c75d3.firebasestorage.app",
        messagingSenderId: "445376886249",
        appId: "1:445376886249:web:662ed2bb984ce230a14778",
        measurementId: "G-7E1HKLYXR0",
      };

      (async () => {
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        auth.useDeviceLanguage();
        await setPersistence(auth, browserLocalPersistence);

        async function handleSignUp() {
          const name = document.getElementById("name").value.trim();
          const school = document.getElementById("school").value.trim();
          let year = document.getElementById("year").value.trim();
          const otherYear = document.getElementById("other-year").value.trim();
          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value.trim();
          const confirmPassword = document
            .getElementById("confirm-password")
            .value.trim();

          if (year === "Other" && otherYear) {
            year = otherYear;
          }

          if (
            !name ||
            !school ||
            !year ||
            !email ||
            !password ||
            !confirmPassword
          ) {
            showToast("‚ö†Ô∏è Please fill in all required fields.", "warning");
            return;
          }

          if (!email.toLowerCase().endsWith("@unc.edu")) {
            showToast("‚ùå Email must end with @unc.edu", "error");
            return;
          }

          if (password !== confirmPassword) {
            showToast("‚ùå Passwords do not match.", "error");
            return;
          }

          try {
            const userCred = await createUserWithEmailAndPassword(
              auth,
              email,
              password
            );
            await sendEmailVerification(userCred.user);

            localStorage.setItem(
              "signupData",
              JSON.stringify({ name, school, year })
            );

            const idToken = await userCred.user.getIdToken();
            await fetch("https://themove-backend-production.up.railway.app/createUser", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${idToken}`,
              },
              body: JSON.stringify({
                uid: userCred.user.uid,
                name,
                school,
                year,
                emailVerified: false,
              }),
            });

            showToast(
              "üì® Verification email sent! Please verify your email, then log in to continue.",
              "success"
            );
            await signOut(auth);
            setTimeout(() => (window.location.href = "/login.html"), 2000);
          } catch (err) {
            console.error("‚ùå Signup error:", err);
            showToast("Error: " + err.message, "error");
          }
        }

        document
          .getElementById("sign-in-button")
          .addEventListener("click", handleSignUp);
      })();

      window.toggleOtherClassInput = function () {
        const yearSelect = document.getElementById("year");
        const otherYearInput = document.getElementById("other-year");
        if (yearSelect.value === "Other") {
          otherYearInput.classList.remove("hidden");
        } else {
          otherYearInput.classList.add("hidden");
          otherYearInput.value = "";
        }
      };
    </script>
  </body>
</html>
